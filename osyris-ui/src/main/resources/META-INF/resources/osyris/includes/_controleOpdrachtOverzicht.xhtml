<u:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:u="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a="http://richfaces.org/a4j" xmlns:r="http://richfaces.org/rich"
	xmlns:d="http://specto.gim.be/display"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:j="http://conscientia.org/jsf"
	xmlns:q="http://specto.gim.be/search"
	xmlns:p="http://primefaces.org/ui">

	<div>
		<h2>Mijn controleopdrachten</h2>
	</div>

	<j:layout style="height: 400px">
		<j:layoutPane region="west" size="350" minSize="200" resizable="true"
			slidable="true">
			<div class="ui-layout-content">
				<d:fields>
					<d:field for="trajectType" label="Traject type">
						<h:selectOneMenu id="trajectType"
							value="#{controleOpdrachtOverzichtFormBase.trajectType}">
							<f:selectItem itemValue="" itemLabel="" />
							<f:selectItems
								value="#{modelUtils.selectItems(osyrisModelFunctions.trajectTypes)}" />
							<a:ajax event="change" render="detailSearchPanel" execute="@this" />
						</h:selectOneMenu>
					</d:field>
					<d:field for="regio" label="Regio">
						<h:selectOneMenu id="regio"
							value="#{controleOpdrachtOverzichtFormBase.regio}">
							<f:converter
								converterId="be.gim.commons.ResourceIdentifierConverter" />
							<f:selectItem itemValue="" itemLabel="" />
							<f:selectItems
								value="#{modelUtils.selectItems(osyrisModelFunctions.regiosOostVlaanderen)}" />
							<a:ajax event="change" render="trajectNaam" execute="@this" />
						</h:selectOneMenu>
					</d:field>
					<j:renderPanel id="detailSearchPanel"
						rendered="#{controleOpdrachtOverzichtFormBase.trajectType.contains('Route')}">
						<d:field for="trajectNaam" label="Traject naam">
							<h:selectOneMenu id="trajectNaam"
								value="#{controleOpdrachtOverzichtFormBase.trajectNaam}">
								<f:selectItem itemValue="" itemLabel="" />
								<f:selectItems
									value="#{modelUtils.selectItems(osyrisModelFunctions.getTrajectNamen(controleOpdrachtOverzichtFormBase.regio, controleOpdrachtOverzichtFormBase.trajectType))}" />
							</h:selectOneMenu>
						</d:field>
					</j:renderPanel>
				</d:fields>
				<q:query value="#{controleOpdrachtOverzichtFormBase.query}"
					modelClassName="#{controleOpdrachtOverzichtFormBase.modelClass.name}">
					<c:if test="#{controleOpdrachtOverzichtFormBase.index}">
						<d:field for="term"
							label="#{messages['page.search.query.term.title']}">
							<q:phrase id="termFilter" value="#{searchForm.term}">
								<h:inputText value="#{searchForm.term}" />
							</q:phrase>
						</d:field>
					</c:if>
					<d:object mode="SEARCH"
						modelClass="#{controleOpdrachtOverzichtFormBase.modelClass}" />
				</q:query>
				<d:fields>
					<b><h:outputText value="Datum laatste statuswijziging">
					</h:outputText></b>
					<d:field for="vanDatum">
						<div>Van:</div>
						<r:calendar id="vanDatum"
							value="#{controleOpdrachtOverzichtFormBase.vanDatum}"
							inputStyle="width:60px"
    						datePattern="dd/MM/yyyy">
						</r:calendar>
					</d:field>
					<d:field for="totDatum">
						<div>Tot:</div>
						<r:calendar id="totDatum"
							value="#{controleOpdrachtOverzichtFormBase.totDatum}"
							inputStyle="width:60px"
    						datePattern="dd/MM/yyyy">
						</r:calendar>
					</d:field>
				</d:fields>
				<d:buttons>
					<j:commandButton rendered="true"
						value="#{messages['page.general.button.search']}"
						image="#{resource['core/images/actions/12x12/apply.png']}"
						type="button"
						actionListener="#{controleOpdrachtOverzichtFormBase.search()}"
						render="objects" />
					<d:fileDownload fileName="#{controleOpdrachtOverzichtFormBase.fileName}"
						type="button"
						image="#{resource['core/images/actions/12x12/download.png']}"
						content="#{controleOpdrachtOverzichtFormBase.report()}"
						value="#{messages['page.actions.report.label']}" />
				</d:buttons>
			</div>
		</j:layoutPane>
		<j:layoutPane>
			<div class="ui-layout-content">
				<a:outputPanel id="result">
					<p:dataTable id="objects"
						value="#{controleOpdrachtOverzichtFormBase.results}"
						lazy="true"
						var="controleOpdracht"
						style="width: 100%;"
						styleClass="model-table"
						paginator="true"
						rows="20"
						paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
						rowsPerPageTemplate="10,20,30,40,50"
						scrollable="true"
						resizableColumns="true"
						tableStyle="min-width: 850px"
						emptyMessage="#{messages['ui.dataTable.empty']}">
						<j:layoutContent />
						<j:bindAttribute var="controleOpdracht"
							name="rowData" />
						<p:column label="Acties">
							<a:outputPanel rendered="true" styleClass="model-table-actions">
								<h:panelGrid columns="3">
									<j:commandButton
										rendered="#{controleOpdrachtOverzichtFormBase.isCanView(controleOpdracht)}"
										image="#{resource['core/images/actions/16x16/view.png']}"
										type="image"
										title="#{messages['page.actions.view.label']}">
										<j:renderListener target="#{r:clientId('viewPanel')}"
											rendered="true" execute="@this" />
										<f:setPropertyActionListener
											target="#{controleOpdrachtOverzichtFormBase.object}"
											value="#{controleOpdracht}" />
									</j:commandButton>
									<j:commandButton
										rendered="#{controleOpdrachtOverzichtFormBase.isCanDelete(controleOpdracht)}"
										image="#{resource['core/images/actions/16x16/delete.png']}"
										type="image"
										title="#{messages['page.actions.delete.label']}">
										<j:renderListener target="#{r:clientId('deletePanel')}"
											rendered="true" execute="@this" />
										<f:setPropertyActionListener
											target="#{controleOpdrachtOverzichtFormBase.object}"
											value="#{controleOpdracht}" />
									</j:commandButton>
								</h:panelGrid>
							</a:outputPanel>
						</p:column>
						<p:column label="TrajectType">
							<f:facet name="header">
							<d:displayLabel
									property="#{d:modelClass('ControleOpdracht').getProperty('trajectType')}" />
							</f:facet>
							<d:propertyValue id="trajectTypeColumn"
								modelProperty="#{d:modelClass('ControleOpdracht').getProperty('trajectType')}"
								value="#{controleOpdracht.trajectType }"
								mode="VIEW" />
						</p:column>
						<p:column label="Periode"
							sortBy="#{controleOpdracht.periode }">
							<f:facet name="header">
								<d:displayLabel
									property="#{d:modelClass('ControleOpdracht').getProperty('periode')}" />
							</f:facet>
							<d:propertyValue id="periodeColumn"
								modelProperty="#{d:modelClass('ControleOpdracht').getProperty('periode')}"
								value="#{controleOpdracht.periode }"
								mode="VIEW" />
						</p:column>
						<p:column label="Traject"
							sortBy="#{controleOpdracht.traject }">
							<f:facet name="header">
								<div>Routenaam</div>
							</f:facet>
							<d:propertyValue id="trajectColumn"
								modelProperty="#{d:modelClass('ControleOpdracht').getProperty('traject')}"
								value="#{controleOpdracht.traject }" mode="VIEW" />
						</p:column>
						<p:column label="Regio">
							<f:facet name="header">
							<d:displayLabel
									property="#{d:modelClass('ControleOpdracht').getProperty('regio')}" />
							</f:facet>
							<d:propertyValue id="regioColumn"
								modelProperty="#{d:modelClass('ControleOpdracht').getProperty('regio')}"
								value="#{controleOpdracht.regio }" mode="VIEW" />
						</p:column>
						<p:column label="Peter/Meter" sortBy="#{controleOpdracht.peterMeter }">
							<f:facet name="header">
								<d:displayLabel
									property="#{d:modelClass('ControleOpdracht').getProperty('peterMeter')}" />
							</f:facet>
							<d:propertyValue id="peterMeterColumn"
								modelProperty="#{d:modelClass('ControleOpdracht').getProperty('peterMeter')}"
								value="#{controleOpdracht.peterMeter }" mode="VIEW" />
						</p:column>
						<p:column label="Medewerker" sortBy="#{controleOpdracht.medewerker }">
							<f:facet name="header">
								<d:displayLabel
									property="#{d:modelClass('ControleOpdracht').getProperty('medewerker')}" />
							</f:facet>
							<d:propertyValue id="medewerkerColumn"
								modelProperty="#{d:modelClass('ControleOpdracht').getProperty('medewerker')}"
								value="#{controleOpdracht.medewerker }"
								mode="VIEW" />
						</p:column>
						<p:column label="Status" sortBy="#{controleOpdracht.status }">
							<f:facet name="header">
								<d:displayLabel
									property="#{d:modelClass('ControleOpdracht').getProperty('status')}" />
							</f:facet>
							<d:propertyValue id="statusColumn"
								modelProperty="#{d:modelClass('ControleOpdracht').getProperty('status')}"
								value="#{controleOpdracht.status }"
								mode="VIEW" />
						</p:column>
						<p:column label="Datum">
							<f:facet name="header">
								<div>Datum</div>
							</f:facet>
							<d:propertyValue id="datumLaatsteWijzigingColumn"
								modelProperty="#{d:modelClass('ControleOpdracht').getProperty('datumLaatsteWijziging')}"
								value="#{controleOpdracht.datumLaatsteWijziging }"
								mode="VIEW" /> 
						</p:column>
					</p:dataTable>
				</a:outputPanel>

				<a:outputPanel>
					<d:buttons>
						<j:commandButton
							rendered="#{controleOpdrachtOverzichtFormBase.canCreate}"
							value="Aanmaken controleopdracht"
							image="#{resource['core/images/actions/12x12/create.png']}"
							type="button">
							<j:renderListener target="createPanel" rendered="true"
								execute="@this" />
						</j:commandButton>
					</d:buttons>
				</a:outputPanel>

				<u:decorate
					template="/resources/osyris/includes/controleOpdrachtPanels.xhtml">
					<u:param name="form" value="#{controleOpdrachtOverzichtFormBase}" />
					<u:param name="render" value="#{r:clientId('result')}" />
				</u:decorate>
			</div>
		</j:layoutPane>
	</j:layout>
</u:composition>