<u:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:u="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:r="http://richfaces.org/rich"
	xmlns:d="http://specto.gim.be/display"
	xmlns:p="http://primefaces.org/ui"
	xmlns:j="http://conscientia.org/jsf"
	xmlns:m="http://specto.gim.be/map">
	<h:outputStylesheet id="fileuploadCss"
		name="fileupload/fileupload.css"
		library="primefaces" />
		
	<h2>#{osyrisModelFunctions.getTrajectNaam(form.object.traject)} (#{osyrisModelFunctions.getTrajectRegio(form.object.traject)}) - #{form.object.trajectType}</h2>
	<br/>
	<table width="100%">
	<tr>
	<td width="50%" valign="top">
	<r:panel id="ProblemenPanel" header="Problemen">	
	<j:renderPanel id="problemPanel">
		<h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="5">  
			<h:selectOneRadio id="probleemType" value="#{form.probleemType}" layout="grid">
	           	<f:selectItem itemValue="bord" itemLabel="Bord Probleem" />
				<f:selectItem itemValue="ander" itemLabel="Ander Probleem" />
				<a:ajax event="change" 
						listener="#{form.createProbleem()}" 
						render="problemPanel" 
						execute="@this"/> 
	       </h:selectOneRadio>
	    </h:panelGrid>
	<br/>
	<j:renderPanel id="probleemPanel" rendered="#{form.probleem != null}">
<!-- 		<d:object mode="EDIT" -->
<!-- 				value="#{form.probleem}" />	 -->

				<a:outputPanel rendered="#{form.isBordProbleem(form.probleem)}">
   					<d:field label="Beschrijving" for="type">	 
						<d:propertyValue id="type"
							modelProperty="#{d:modelClass('BordProbleem').getProperty('type')}"
							value="#{form.probleem.type}"
							mode="EDIT" />
					</d:field>
				</a:outputPanel>
				
				<a:outputPanel rendered="#{!form.isBordProbleem(form.probleem)}">
					<d:field label="Beschrijving" for="categorie">	 
						<d:propertyValue id="categorie"
							modelProperty="#{d:modelClass('AnderProbleem').getProperty('categorie')}"
							value="#{form.probleem.categorie}"
							mode="EDIT" />
					</d:field>
				</a:outputPanel>
				
				<d:field label="Foto" for="foto">	 
						<d:propertyValue id="foto"
							modelProperty="#{d:modelClass('Probleem').getProperty('foto')}"
							value="#{form.probleem.foto}"
							mode="EDIT" />
					</d:field>
					
				<d:propertyField id="commentaar"
				 		modelProperty="#{d:modelClass('Probleem').getProperty('commentaar')}"
						value="#{form.probleem.commentaar}"
						mode="EDIT" />
						
		<a:outputPanel rendered="#{form.probleemType == 'bord'}">
		<d:fields>
			<b><h:outputText value="Selecteer maximaal 1 bord op kaart "></h:outputText></b>
			<h:graphicImage alt="(verplicht)"
						value="#{resource['core/images/actions/12x12/required_alt.png']}" />
		</d:fields>
		<j:commandButton
			id="selectFeatures"
			rendered="#{form.probleemType == 'bord'}"
			image="#{resource['core/images/actions/24x24/select.png']}"
			styleClass="component-toolbar-button"
			value="Selecteer bord op kaart"
			title="#{messages['model.entry.mapContext.tools.selectFeatures.label']}"
			submit="false">
			<j:activateControl
				for="viewer"
				event="click"
				control="selectBox" />
		</j:commandButton>
		</a:outputPanel>
		
		<a:outputPanel rendered="#{form.probleemType == 'ander'}">
		<br/>
		<d:fields>
		<b><h:outputText value="Duid probleem(punt) aan op kaart "></h:outputText></b>
		<h:graphicImage alt="(verplicht)"
						value="#{resource['core/images/actions/12x12/required_alt.png']}" />
		</d:fields>
		<j:commandButton
			id="drawPoint"
			rendered="#{form.probleemType == 'ander'}"
			image="#{resource['core/images/actions/24x24/drawPoint.png']}"
			styleClass="component-toolbar-button"
			value="Teken punt"
			action="#{form.switchToPointGeomLayer()}"
			immediate="true">
			<j:activateControl
				for="viewer"
				event="click"
				control="drawPoint" />
		</j:commandButton>
		</a:outputPanel>
		
		<a:outputPanel rendered="#{form.probleemType == 'ander' }">
		<br/>
		<br/>
		<d:fields>
		<b><h:outputText value="Duid omleiding aan op kaart (optioneel)"></h:outputText></b>
		</d:fields>
		<j:commandButton
			id="drawLineString"
			rendered="#{form.probleemType == 'ander' }"
			image="#{resource['core/images/actions/24x24/drawLineString.png']}"
			styleClass="component-toolbar-button"
			value="Teken lijn"
			action="#{form.switchToLineGeomLayer()}"
			immediate="true">
			<j:activateControl
				for="viewer"
				event="click"
				control="drawLineString" />
		</j:commandButton>
		</a:outputPanel>
	<d:buttons>
		<j:commandButton value="Probleem toevoegen" rendered="true"
			image="#{resource['core/images/actions/12x12/apply.png']}"
			type="button"
			action="#{form.addProbleem()}" render="problemPanel" execute="problemPanel">
		</j:commandButton>
	</d:buttons>
	</j:renderPanel>
	<br/>
	
	<!-- Probleem tabellen -->
	<u:decorate
		template="/resources/osyris/includes/problemenOverzichtTables.xhtml">
		<u:param name="form" value="#{form}" />
	</u:decorate>
	
   	</j:renderPanel>
   	</r:panel>
   	<br/>
   	<r:panel header="Terreinbezoek">
  		<d:fields>
   		<d:field label="Datum terreinbezoek" for="datumTerreinBezoek">	 
		<d:propertyValue id="datumTerreinBezoek" 
				modelProperty="#{d:modelClass('ControleOpdracht').getProperty('datumTerreinBezoek')}" 
				value="#{form.object.datumTerreinBezoek}" 
				mode="EDIT" />
			</d:field>
	</d:fields>
	</r:panel>
	</td>
	<td width="50%" valign="top">
		<r:panel>
			<div style="height: 500px">
				<m:mapViewer id="viewer"
					configuration="#{form.configuration}">
					<j:controllerListener name="selectedFeatures"
						listener="#{form.onSelectFeatures}" />
					<j:controllerListener name="addedFeature"
						listener="#{form.onUpdateFeatures}" />
				</m:mapViewer>
			</div>
		</r:panel>
		<u:decorate
			template="/resources/osyris/includes/baseLayerSwitch.xhtml">
			<u:param name="form" value="#{form}" />
		</u:decorate>
	</td>
	</tr>
	</table>
	<d:buttons>
		<j:commandButton value="#{messages['form.general.save.button']}"
			image="#{resource['core/images/actions/12x12/save.png']}"
			type="button"
			action="#{form.save()}"
			render="#{r:clientId('problemenOverzichtPanel')}"
			oncomplete="conscientia.widget(#{r:element('rapporteerPopup')}).hide();" />
		<j:commandButton 
			value="Verzenden"
			image="#{resource['core/images/actions/12x12/next.png']}"
			type="button"
			immediate="true"
			oncomplete="conscientia.widget(#{r:element('confirmVerzendenPopup')}).show();" />
	</d:buttons>
</u:composition>